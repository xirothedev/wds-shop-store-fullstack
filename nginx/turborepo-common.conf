# Common Nginx configuration for Turborepo applications
# Place at: /etc/nginx/conf.d/turborepo-common.conf

# Upstream for Next.js application
upstream nextjs_upstream {
    server localhost:3000;
    keepalive 64;
}

# Upstream for NestJS API
upstream nestjs_upstream {
    server localhost:4000;
    keepalive 64;
}

# Rate limiting zones
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=web_limit:10m rate=30r/s;

# Security headers (applied globally)
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;

# Remove Nginx version
server_tokens off;
